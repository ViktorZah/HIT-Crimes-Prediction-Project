import dataclasses
import datetime

from selenium import webdriver
import time
from selenium.webdriver.common.by import By #lets us use the By. function;
import pandas as pd

@dataclasses.dataclass
class Row:
    _id                      : str
    case_number           : str
    date                      : str
    block                      : str
    iusr                      : str
    primary_type           : str
    description           : str
    location_description           : str
    arrest                      : bool
    domestic                      : bool
    beat                      : str
    district                      : str
    ward                      : str
    community_area           : str
    fbi_code             : str
    x_coordinate           : str
    y_coordinate           : str
    year                      : int #17
    updated_on              : str
    latitude                      : float
    longitude              : float

    @property
    def location(self) -> (float, float):
        return self.longitude, self.latitude

    def to_dict(self):
        return {
       '_id': self._id,
       'case_number': self.case_number,
       'date': self.date,
       'block': self.block,
       'iusr': self.iusr,
       'primary_type': self.primary_type,
       'description': self.description,
       'location_description': self.location_description,
       'arrest': self.arrest,
       'domestic': self.domestic,
       'beat': self.beat,
       'district': self.district,
       'ward': self.ward,
       'community_area': self.community_area,
       'fbi_code': self.fbi_code,
       'x_coordinate': self.x_coordinate,
       'y_coordinate': self.y_coordinate,
       'year': self.year,
       'updated_on': self.updated_on,
       'latitude': self.latitude,
       'longitude': self.longitude,
       'location': self.location
        }

website = 'https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present-Dashboard/5cd6-ry5g'
path = '\Desktop'

driver = webdriver.Chrome(path)
driver.get(website)
time.sleep(10)#in-order to let the website load all the data in the table; change the '0' to something else later;

cell_counter = 0
attrs = []
# 8 9 17 19 20
rows = []

for content in driver.find_elements(By.CLASS_NAME,'cell-content'):
    try:
        content = content.text
        if cell_counter in (8, 9):
            content = True if content else False

        if cell_counter == 17:
            content = int(content)

        if cell_counter in (19, 20):
            content = float(content)
        attrs.append(content)
        cell_counter += 1

        if cell_counter > 21:
            attrs.pop()
            rows.append(Row(*attrs))
            attrs = []
            cell_counter = 0


    except:
        continue
for row in rows:
    print(row)

df = pd.DataFrame([obj.to_dict() for obj in rows])
df.to_csv('testingData.csv')
driver.quit()




